# SPECIFIC-GERPAAS v2 — Архитектура и ответственность модулей (AGENTS)

## 1. Призначення
Плагін SPECIFIC-GERPAAS v2 автоматизує побудову специфікації кабеленесучих систем GERPAAS на основі моделі, побудованої за допомогою плагіна DKC у Autodesk Revit 2022.

## 2. Обмеження
- Працює тільки з Revit 2022.
- Розробка на .NET Framework 4.8, C# 7.3.
- Взаємодія з базою відбувається через Microsoft.Data.Sqlite.
- Алгоритм працює тільки з моделями кабельних лотків DKC типу S5.
- Не виконує модифікацію геометрії моделі.
- Пріоритет: коректність побудови артикулів та найменувань.

## 3. Головні модулі (AGENTS)
| № | Модуль | Призначення |
|---|--------|--------------|
| 3.1 | `Commands/` | Команди Revit (вхідні точки плагіна). |
| 3.2 | `Core/SpecSynchronizer.cs` | Центральний алгоритм обробки елементів моделі та заповнення параметрів спецификації. |
| 3.3 | `Core/ArticleBuilder.cs` | Побудова артикулу GERPAAS за правилами. |
| 3.4 | `Core/SizeHelper.cs` | Витяг розмірів та кута елементів моделі. |
| 3.5 | `Core/ParamHelper.cs` | Запис текстових параметрів Revit. |
| 3.6 | `Core/CatalogSqlite.cs` | Робота з базою `gerpaas.db`. Пошук рядків за артикулом. |
| 3.7 | `UI/RibbonBuilder.cs` | Інтеграція у стрічку Revit. Комбі-блоки вибору параметрів. |
| 3.8 | `Utils/Logger.cs` | Логування у файл `Message.log`. |
| 3.9 | `Data/GERP_param_map.ini` | Конфігурація правил: базові артикули GERPAAS, категорії, додаткові примітки, правила для кришок і SDE. |

## 4. Дані
### 4.1 Параметри Revit, які заповнює плагін
| Параметр | Призначення |
|----------|-------------|
| `GE_Категорія` | Розділ специфікації: 1 — лотки, 2 — з’єднувальні деталі, 3 — монтажні вироби |
| `GE_Артикул` | Артикул GERPAAS (побудований) |
| `GE_Найменування` | Назва виробу з бази `gerpaas.db` |
| `GE_Додаткові` | Текст додаткової інформації (опціонально) |
| `GE_Кількість` | Штучний параметр кількості (0 або 1) для універсальних формул |

### 4.2 Вхідні параметри з Revit (не змінюються)
| Параметр | Призначення |
|----------|-------------|
| `DKC_ВысотаЛотка`, `DKC_ШиринаЛотка` | Розміри лотків |
| `DKC_Angle` | Кут для відводів |
| `DKC_ДлинаФакт` | Довжина секцій |
| `GE_Варіант` | Перемикач SDE/IBF/OBF для деяких вигинів |

### 4.3 GERP_param_map.ini
Єдиний конфігураційний файл:
- Секція `[FamilyMap]` — відповідність сімейства → базовий артикул GERPAAS і категорія.
- Секція `[AccessoryRules]` — правила обробки кришок.
- Секція `[Combo]` — налаштування товщини та покриття з UI.

## 5. Глосарій термінів
| Термін | Пояснення |
|--------|-----------|
| CatalogRow | Об’єкт з однією строкою з `gerpaas.db` |
| Article | Артикул виробу GERPAAS |
| BaseArticle | Початок артикула (префікс з FamilyMap.ini) |
| SDE | Альтернативний варіант вигину за вибором користувача |
| INI | Формат текстового конфігураційного файлу |
| LookupParameter | API Revit: читання параметра елемента |

## 6. Список завдань, що вирішує плагін
1. Аналіз елементів моделі Revit.
2. Розпізнавання типу елементу (лоток, кришка, фітинг, аксесуар).
3. Побудова артикула згідно правил.
4. Знаходження відповідного рядка у `gerpaas.db`.
5. Заповнення українських специфікаційних параметрів.
6. Формування коректної таблиці для експорту.
