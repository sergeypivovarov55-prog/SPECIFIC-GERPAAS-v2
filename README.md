# 1. README

## 1.1. Опис
Плагін SPECIFIC-GERPAAS для Autodesk Revit 2022 призначений для автоматичного створення специфікацій згідно з ДСТУ 9243.10:2023 кабеленесучих систем GERPAAS на основі моделі, побудованої за допомогою плагіна DKC.  
Особливості алгоритму:
 - не виконує модифікацію геометрії моделі та специфікацій;
 - зчитує дані з елементів моделі кабельних лотків виробництва DKC типу S5;
 - формує артикули аналогів виробництва GERPAA;
 - зчитує найменування та інші дані з бази даних, створенної на основі каталогів GERPAAS;
 - записує значення в параметри проекту, з яких формується специфікація;
 - експортує специфікацію GERPAAS з формату Revit в формат Excel (.csv).

## 1.2. Вимоги до програмних засобів
 - система автоматизованого проектування - Autodesk Revit 2022;
 - середовище розробки - Visual Studio 2022 v17.14.10;
 - мова программування - C# 7.3;
 - робоче середовище - .NET Framework 4.8;
 - взаємодія з базою даних - Microsoft.Data.Sqlite v7.0.5.

## 1.3. Вимоги до установки
 - зібрати проєкт у Visual Studio 2022;
 - скопіювати `SpecificGerpaas.addin` до `%AppData%\Autodesk\Revit\Addins\2022\`;
 - скопіювати зібрані DLL до однієї директорії з `.addin`;
 - перезапустити Revit.

## 1.4. Статус розробки
Активна фаза - рефакторинг коду.
Поточна гілка — `refactor/structure` ???

## 1.5. Авторські права
ТОВ "Совпромпроект"

# 2. AGENTS

## 2.1. Структура
 - Commands/ – команди Revit API (вхідні точки плагіна);
 - Core/ – основна логіка 
 - Data/ – конфігураційний файл, файл бази даних, методи їз обробки;
 - Resources/ - пікотограми для кнопок;
 - UI/ – стрічка Revit, кнопки, комбо-бокси, повідомлення;
 - Utils/ – допоміжні функції.

## 2.2. Головні модулі (AGENTS)
 - `Core/SpecSynchronizer.cs` - центральний алгоритм обробки елементів моделі та заповнення параметрів спецификації;
 - `Core/ArticleBuilder.cs` - побудова артикулу GERPAAS за правилами;
 - `Core/ArticleFormat.cs` – нормалізація частин артикула: товщина, покриття, форматування коду GERPAAS;
 - `Core/Log.cs` - логування позаштатних подій у файл `Message.log`;
 - `Data/GERP_param_map.ini` - конфігурація правил: базові артикули GERPAAS, категорії, додаткові примітки, правила для кришок і SDE;
 - `Data/CatalogSqlite.cs` - робота з базою `gerpaas.db`; пошук рядків за артикулом;
 - `UI/RibbonBuilder.cs` - інтеграція у стрічку Revi; комбо-бокси вибору параметрів Revit; кнопки запуску команд;
 - `Utils/MassHelper.cs` – підстановка маси виробів з бази `gerpaas.db` у параметри Revit (`DKC_Масса`, `DKC_Масса погонного метра`);
 - `Utils/SizeHelper.cs` - читання значень розмірів та кутів елементів моделі;
 - `Utils/ParamHelper.cs` - запис текстових параметрів Revit.

## 2.3. Дані

### 2.3.1. GERP_param_map.ini
Єдиний конфігураційний файл із секціями:
 - `[FamilyMap]` — відповідність сімейства → базовий артикул GERPAAS і категорія;
 - `[AccessoryRules]` — правила обробки кришок;
 - `[Combo]` — налаштування значень товщини та покриття з UI (єдиних для всього проекту).

### 2.3.2. Параметри Revit, які є вхідними для плагіна, не змінюються
 - `DKC_ВысотаЛотка`, `DKC_ШиринаЛотка` - значення розмірів лотків;
 - `DKC_Angle` - значення кутів для відводів;
 - `DKC_ДлинаФакт` - значення довжини прямих ділянок лотків;
 - `GE_Варіант` - перемикач SDE/IBF/OBF для вибору вертикальних відводів, заповнює користувач.

### 2.3.3. Параметри Revit, які заповнює плагін
 - `GE_Категорія` - розділ специфікації: 1 — лотки, 2 — з’єднувальні деталі, 3 — монтажні вироби;
 - `GE_Артикул` - артикул GERPAAS, побудований плагіном;
 - `GE_Найменування` - назва виробу з бази `gerpaas.db`;
 - `GE_Додаткові` - текст додаткових відомостей (опціонально);
 - `GE_Кількість` - умовний параметр кількості (0 або 1) для формул специфікації.

## 2.4. Глосарій термінів
 - CatalogRow - об’єкт з однією строкою з `gerpaas.db`;
 - Article - артикул виробу GERPAAS згідно з каталогом виробника;
 - BaseArticle - базовий артикул (префікс з GERP_param_map.ini);
 - SDE - альтернативний варіант вертикального відводу за вибором користувача;
 - INI - формат текстового конфігураційного файлу;
 - LookupParameter API Revit - читання параметра елемента.

## 2.5. Список завдань, що вирішує плагін
 - аналіз елементів моделі Revit;
 - розпізнавання типу елементу (лоток, кришка, фітинг, аксесуар);
 - побудова артикула згідно правил;
 - знаходження відповідного рядка у `gerpaas.db`;
 - заповнення українських специфікаційних параметрів;
 - формування таблиці експорту у форматі .csv.

#3. ROADMAP

## 3.1. Завершені етапи
 - Ініціалізація репозиторію GitHub - Виконано;
 - Налаштування структури проекту - Виконано;
 - Інтеграція Sqlite - Виконано;
 - Читання конфігурації GERP_param_map.ini - Виконано;
 - Побудова артикула для лотків - Виконано;
 - Побудова артикула для горизонтальних вигинів 45/90 - Виконано;
 - Вибір SDE через параметр GE_Варіант - Виконано;
 - Логування процесу в Message.log - Виконано;

## 3.2. Поточний стан
 - Плагін компілюється під .NET Framework 4.8 (C# 7.3), Revit 2022;
 - Є підключення Microsoft.Data.Sqlite і читання бази `gerpaas.db`;
 - Реалізована побудова артикула GERPAAS для частини виробів DKC;
 - Реалізовано логування у `Message.log`;
 - Реалізовано читання параметрів Revit (розміри, кут, довжина);
 - Реалізовано читання конфігурації з `Data/GERP_param_map.ini`;
 - Фіксується параметр `GE_Варіант` для ручного перемикання логіки SDE.
 - Потрібно ___________________

## 3.3. План робіт

### 3.3.1 Поточний етап
 - завершення рефакторингу файлів:
	`Core/SpecSynchronizer.cs`
	`Core/ArticleBuilder.cs`
	`Core/ArticleFormat.cs`
	`Utils/MassHelper.cs`
	`Utils/ParamHelper.cs`
 - коректний запис значеннь маси одиниці в параметри проекту (зараз записується лише ціла частина значення, десятичні значення дробу відкидаються);
 - доповнення обробки параметра GE_Кількість для типів, що мають декілька штук в комплекті;
 - завершення категоризацію 1/2/3/4 (лотки/деталі/аксесуари/інше);
 
### 3.3.2 Наступні етапи
 - вирішення проблеми з додаваннм додаткової строчки в специфікацію для кришок вертикальних кутів "GE-KT2-IBF-" и "GE-KT2-OBF-", які відсутні в моделі, шляхом програмного додавання відповідних елементів в модель із заповненням значеннями відповідних параметрів проекту;
 - обробка елементів категорії "4. Інше";
 - розширення обробки сімейства "999_DKC_Accessories" ;
 - перевірка стабільністі SDE
 - обробка undefined-елементів;
 - розробка функції "Проставити позиції" с динамічним зв'язком з моделлю з можливістю простановки на видах виносок з автопідстановкою номера позиції по специфікації.

## 3.4. Правила розробки
 - обов’язкове логування у `Message.log` для ключових операцій;
 - не змінювати дані в БД `gerpaas.db`;
 - будь-яка логіка має бути розширюваною, без хардкоду.

## 3.5. Додаткові вимоги
 - без смайликів та емодзі;
 - без прогнозів про те, як будет працювати код;
 - без зайвих уточнюющих питань;
 - облік кількісті повідомлень у технічному діалозі.

